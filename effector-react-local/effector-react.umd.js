((e,t)=>{'object'==typeof exports&&'undefined'!=typeof module?t(exports,require('react'),require('effector')):'function'==typeof define&&define.amd?define(['exports','react','effector'],t):t((e='undefined'!=typeof globalThis?globalThis:e||self).effectorReact={},e.React,e.effector)})(this,((e,t,effector)=>{function n(e){return e&&'object'==typeof e&&'default'in e?e:{default:e}}function r(e,t,n){let r={node:[effector.step.run({fn:e=>t(e)})]};if(n){let t=effector.createNode(r),o=e.graphite.id,u=n.additionalLinks[o]=n.additionalLinks[o]||[];return u.push(t),()=>{let e=u.indexOf(t);-1!==e&&u.splice(e,1),effector.clearNode(t)}}{r.parent=e,r.family={type:'crosslink',owners:e};let t=effector.createNode(r);return()=>{effector.clearNode(t)}}}function o(e,t){return t.displayName=e,t}function u(e,t){effector.is.store(e)||y('expect useStore argument to be a store');let n=m(e,t),o=g(),u=d.default.useRef({store:e,value:n,pending:0});return p((()=>{let n=r(e,(e=>{let t=u.current;t.pending||(t.value=e,t.pending=1,o(),t.pending=0)}),t),a=m(e,t),l=u.current;return l.store===e&&l.value!==a&&(l.value=a,l.pending=1,o(),l.pending=0),l.store=e,n}),[e]),n}function a([e,t],n){let o,u,a,s=k;t?(o=t,u=e,a=[]):(o=e.fn,u=e.store,a=e.keys,s=e.updateFilter||k),effector.is.store(u)||y('useStoreMap expects a store'),Array.isArray(a)||y('useStoreMap expects an array as keys'),'function'!=typeof o&&y('useStoreMap expects a function');let f=d.default.useRef({}),c=f.current;c.fn=o,c.upd=s,c.init=c.store===u,c.store=u;let i=g(),h=d.default.useMemo((()=>(l(m(u,n),a,f.current),r(u,(e=>l(e,a,f.current,i)),n))),a);return p((()=>()=>h()),a),c.val}function l(e,t,n,r){let o=n.fn(e,t);n.init?void 0!==o&&k(o,n.val)&&n.upd(o,n.val)&&(n.val=o,r&&r()):(n.val=o,n.init=1)}function s(e){return u(e)}function f(e,t){function n(e){let n=d.default.useRef(e),o=s(r);p((()=>(a({props:n.current,state:r.getState()}),()=>{l({props:n.current,state:r.getState()})})),[]);let u=t(e,o);return n.current=e,u}let r;effector.is.store(e)?r=e:'object'==typeof e&&null!==e?r=effector.combine(e):y('shape should be a store or object with stores');let u='Unknown';r&&r.shortName&&(u=r.shortName);let a=effector.createEvent(),l=effector.createEvent();return n.mounted=a,n.unmounted=l,o(`${u}.View`,n)}function c(e,t){return o(`Connect(${t.displayName||t.name||'Unknown'})`,(n=>d.default.createElement(t,{...n,...s(e)})))}function i(e,t={}){let n=d.default.useRef(null);p((()=>(e.open(n.current),()=>e.close(n.current))),[e]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){let o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(n.current,t)||(n.current=t,e.set(t))}var d=n(t);let p='undefined'!=typeof window?d.default.useLayoutEffect:d.default.useEffect,y=e=>{throw Error(e)};const m=(e,t)=>t?t.getState(e):e.getState(),k=(e,t)=>e!==t,g=()=>d.default.useReducer((e=>e+1),0)[1];e.connect=e=>t=>{let n=e;return'function'!=typeof e&&(n=t,t=e),c(t,n)},e.createComponent=f,e.createContextComponent=(e,t,n)=>o(`${e.shortName||'Unknown'}.ContextComponent`,(r=>{let o=d.default.useContext(t),u=s(e);return n(r,u,o)})),e.createGate=(e="gate",t={})=>{let n;return'object'==typeof e&&null!==e&&('defaultState'in e&&(t=e.defaultState),e.domain&&(n=e.domain),e=e.name),(({name:e="gate",domain:t,defaultState:n,hook:r})=>{function u(e){return r(u,e),null}let a=`${t?`${t.compositeName.fullName}/`:''}${e}`,l=effector.createEvent(`${a}.set`),s=effector.createEvent(`${a}.open`),f=effector.createEvent(`${a}.close`),c=effector.createStore(Boolean(0),{name:`${a}.status`}).on(s,(()=>Boolean(1))).on(f,(()=>Boolean(0))),i=effector.createStore(n,{name:`${a}.state`}).on(l,((e,t)=>t)).reset(f);if(t){let{hooks:e}=t;effector.launch({target:[e.store,e.store,e.event,e.event,e.event],params:[c,i,s,f,l]})}return u.open=s,u.close=f,u.status=c,u.state=i,u.set=l,o(`Gate:${a}`,u)})({name:e,domain:n,defaultState:t,hook:i})},e.createReactState=c,e.createStoreConsumer=e=>f(e,(({children:e},t)=>e(t))),e.useEvent=e=>e,e.useGate=i,e.useList=(e,t)=>((e,t,n)=>{let r,l,s=[];'object'==typeof t&&null!==t?(t.keys&&(s=t.keys),r=t.fn,t.getKey&&(l=t.getKey)):r=t,effector.is.store(e)||y('expect useList first argument to be a store'),'function'!=typeof r&&y("expect useList's renderItem to be a function"),Array.isArray(s)||y("expect useList's keys to be an array");let f=d.default.useMemo((()=>{let t=o(`${e.shortName||'Unknown'}.Item`,(t=>{let{index:r,keys:o,keyVal:u,value:l}=t;if(c.current[1])return c.current[0](l,u);let s=a([{store:e,keys:[r,...o],fn:(e,t)=>e[t[0]]}],n);return c.current[0](s,r)}));return d.default.memo(t)}),[e,!!l]),c=d.default.useRef([r,l]);c.current=[r,l];let i=d.default.useMemo((()=>s),s);if(l)return u(e,n).map((e=>{let t=c.current[1](e);return d.default.createElement(f,{keyVal:t,key:t,keys:i,value:e})}));{let t=a([{store:e,keys:[e],fn:e=>e.length}],n);return Array.from({length:t},((e,t)=>d.default.createElement(f,{index:t,key:t,keys:i})))}})(e,t),e.useStore=s,e.useStoreMap=(e,t)=>a([e,t]),Object.defineProperty(e,'__esModule',{value:1})}));
//# sourceMappingURL=effector-react.umd.js.map
