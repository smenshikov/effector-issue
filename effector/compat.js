'use strict';function e(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function r(r,n){var it="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(it)return(it=it.call(r)).next.bind(it);if(Array.isArray(r)||(it=function(r,n){if(r){if("string"==typeof r)return e(r,n);var t={}.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?e(r,n):void 0}}(r))||n&&r&&"number"==typeof r.length){it&&(r=it);var t=0;return function(){return t>=r.length?{done:1}:{done:0,value:r[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function n(e,r,n,t){(D(e)||_(e))&&('family'in e||'graphite'in e)||O(r+": expect "+n+" to be a unit (store, event or effect)"+t)}function t(e,r,t){if(Array.isArray(e))for(var a=0;a<e.length;a++)n(e[a],r,a+" item of "+t,'');else n(e,r,t,' or array of units')}function a(e,r){he={parent:he,value:e,template:me(e,'template')||ye(),sidRoot:me(e,'sidRoot')||he&&he.sidRoot};try{return r()}finally{he=de(he)}}function o(e){for(var r=void 0===e?{}:e,n=r.node,t=void 0===n?[]:n,a=r.parent,o=r.child,i=void 0===o?r.to||r.target:o,u=r.scope,f=void 0===u?{}:u,c=r.meta,s=void 0===c?{}:c,l=r.family,d=void 0===l?{type:'regular'}:l,p=r.regional,m=ke(void 0===a?r.from||r.source:a),v=ke(d.links),g=ke(d.owners),h=[],y=0;y<t.length;y++){var b=t[y];b&&h.push(b)}for(var k={id:B(),seq:h,next:ke(i),meta:s,scope:f,family:{type:d.type||"crosslink",links:v,owners:g}},x=0;x<v.length;x++)oe(v[x]).push(k);for(var w=0;w<g.length;w++)ie(g[w]).push(k);for(var S=0;S<m.length;S++)m[S].next.push(k);return p&&he&&ge(se(he),[k]),k}function i(e,r){for(var n in e)r(e[n],n)}function u(e,r){e.forEach(r)}function f(e,r,n){var t=Ee,a=null,o=Me;if(e.target&&(r=e.params,n=e.defer,t='page'in e?e.page:t,e.stack&&(a=e.stack),o=pe(e)||o,e=e.target),o&&Me&&o!==Me&&(Me=null),Array.isArray(e))for(var i=0;i<e.length;i++)Ne('pure',t,ae(e[i]),a,r[i],o);else Ne('pure',t,ae(e),a,r,o);if(!n||De){var u,f,c,s,l,d,p={isRoot:De,currentPage:Ee,forkPage:Me,isWatch:_e};De=0;e:for(;s=Ce();){var m=s.idx,v=s.stack,g=s.type;c=v.node,Ee=l=v.page,Me=pe(v),l?d=l.reg:Me&&(d=Me.reg);var h=!!l,y=!!Me,b={fail:0,scope:c.scope};u=f=0;for(var k=m;k<c.seq.length&&!u;k++){var x=c.seq[k];switch(x.type){case"barrier":var w=x.data,j=w.priority,I=w.barrierID,M=l?l.fullID+"_"+I:I;if(k!==m||g!==j){Oe.has(M)||(Oe.add(M),qe(k,v,j,I));continue e}Oe.delete(M);break;case'mov':var P=x.data,C=void 0;switch(P.from){case A:C=se(v);break;case"a":case'b':C=v[P.from];break;case"value":C=P.store;break;case S:if(d&&!d[P.store.id])if(h){var N=Ve(l,P.store.id);v.page=l=N,N?d=N.reg:y?(Te(Me,P.store),d=Me.reg):d=void 0}else y&&Te(Me,P.store);C=Z(d&&d[P.store.id]||P.store)}switch(P.to){case A:v.value=C;break;case"a":case'b':v[P.to]=C;break;case S:Be(l,Me,c,P.target).current=C}break;case'check':f=se(v)===('defined'===x.data.type?void 0:Z(Be(l,Me,c,x.data.store)));break;case"filter":f=!He(b,x.data,v);break;case'run':if(k!==m||"effect"!==g){qe(k,v,"effect");continue e}case'compute':_e='watch'===me(c,'op'),v.value=He(b,x.data,v),_e=p.isWatch}u=b.fail||f}if(!u){for(var q=0;q<c.next.length;q++)Ne('child',l,c.next[q],v,se(v),pe(v));var F=pe(v);if(F){me(c,'needFxCounter')&&Ne('child',l,F.fxCount,v,0,F),me(c,'storeChange')&&Ne('child',l,F.storeChange,v,0,F);var O=F.additionalLinks[c.id];if(O)for(var D=0;D<O.length;D++)Ne('child',l,O[D],v,se(v),F)}}}De=p.isRoot,Ee=p.currentPage,Me=pe(p)}}function c(e,r){void 0===r&&(r='combine');var n=r+'(',t='',a=0;return i(e,(function(e){a<25&&(null!=e&&(n+=t,n+=j(e)?Le(e).fullName:e.toString()),a+=1,t=', ')})),n+')'}function s(e,r){var n,t,a=e;if(r){var o=Le(r);0===e.length?(n=o.path,t=o.fullName):(n=o.path.concat([e]),t=0===o.fullName.length?e:o.fullName+'/'+e)}else n=0===e.length?[]:[e],t=e;return{shortName:a,fullName:t,path:n}}function l(e){var r=ye();if(r){for(var n=r.handlers[e],t=arguments.length,a=new Array(t>1?t-1:0),o=1;o<t;o++)a[o-1]=arguments[o];if(n)return n.apply(void 0,[r].concat(a))}}function d(e,r,n,t){var a=Ee,o=null;if(r)for(o=Ee;o&&o.template!==r;)o=de(o);ze(o);var i=e.create(n,t);return ze(a),i}function p(e,r){var n=function e(r){for(var n=arguments.length,a=new Array(n>1?n-1:0),o=1;o<n;o++)a[o-1]=arguments[o];return Ee?d(e,t,r,a):e.create(r,a)};n.graphite=o({meta:nr("event",n,r,e),regional:1}),n.create=function(e){return f({target:n,params:e,forkPage:Me}),e},n.watch=T(Ze,n),n.map=function(e){return ar(n,"map",e,[G({fn:te})])},n.filter=function(e){return ar(n,"filter",e.fn?e:e.fn,[J({fn:te})])},n.filterMap=function(e){return ar(n,'filterMap',e,[G({fn:te}),$.defined()])},n.prepend=function(e){var r=p('* \u2192 '+n.shortName,{parent:de(n)});return l('eventPrepend',ae(r)),Xe(r,n,{scope:{fn:e},node:[G({fn:te})],meta:{op:'prepend'}}),rr(n,r),r};var t=ye();return n}function m(e,n){function a(e,r){d.off(e),le(d).set(e,Qe(or(e,d,'on',1,r,v)))}var i=Y(e),u=Y(e),c=tr('updates');l('storeBase',i,u);var s=i.id,d={subscribers:new Map,updates:c,defaultState:e,stateRef:i,getState:function(){var e,r=i;if(Ee){for(var n=Ee;n&&!n.reg[s];)n=de(n);n&&(e=n)}return!e&&Me&&(Te(Me,i,1),e=Me),e&&(r=e.reg[s]),Z(r)},setState:function(e){f({target:d,params:e,defer:1,forkPage:Me})},reset:function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];for(var t=0,a=r;t<a.length;t++){var o=a[t];d.on(o,(function(){return d.defaultState}))}return d},on:function(e,n){if(t(e,'.on','first argument'),Array.isArray(e))for(var o,i=r(e);!(o=i()).done;)a(o.value,n);else a(e,n);return d},off:function(e){var r=le(d).get(e);return r&&(r(),le(d).delete(e)),d},map:function(e,r){var n,t,a;D(e)&&(t=e,e=e.fn),void 0!==r&&console.error('second argument of store.map is deprecated, use updateFilter instead');var o=d.getState();ye()?a=null:void 0!==o&&(a=e(o,r));var u=m(a,((n={name:d.shortName+" \u2192 *"})["\u0254"]=t,n.strict=0,n)),f=or(d,u,"map",0,e);return ee(ue(u),{type:"map",fn:e,from:i}),ue(u).noInit=1,l('storeMap',i,f),u},watch:function(e,r){if(!r||!j(e)){var n=Ze(d,e);return l('storeWatch',i,e)||e(d.getState()),n}return _(r)||O('second argument should be a function'),e.watch((function(e){return r(d.getState(),e)}))}},p=nr(S,d,n),v=d.defaultConfig.updateFilter;return d.graphite=o({scope:{state:i},node:[$.defined(),$.changed({store:u}),v&&W({store:u,to:"a"}),v&&J({fn:function(e,r,n){return v(e,n.a)}}),Q({store:i}),Q({store:u})],child:c,meta:p,regional:1}),p.sid&&(p.storeChange=1,i.sid=p.sid),Pe&&void 0===e&&O("current state can't be undefined, use null instead"),ge(d,[c]),d}function v(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var t,a,o;Ue(r[0],(function(e,n){o=e,r=n}));var i,u,f,c=r[r.length-1];if(_(c)?(a=r.slice(0,-1),t=c):a=r,1===a.length){var s=a[0];M(s)||(i=s,u=1)}if(!u&&(i=a,t)){f=1;var l=t;t=function(e){return l.apply(void 0,e)}}return D(i)||O('shape should be an object'),ir(Array.isArray(i),!f,i,o,t)}function g(){var e={};return e.req=new Promise((function(r,n){e.rs=r,e.rj=n})),e.req.catch((function(){})),e}function h(e,r){var n=p(e,r),t=n.defaultConfig.handler||function(){return O("no handler used in "+n.getType())},a=ae(n);ve(a,'unit',n.kind="effect"),n.use=function(e){return _(e)||O('.use argument should be a function'),t=e,n};var i=n.finally=tr('finally'),u=n.done=i.filterMap({named:'done',fn:function(e){if('done'===e.status)return{params:e.params,result:e.result}}}),c=n.fail=i.filterMap({named:'fail',fn:function(e){if('fail'===e.status)return{params:e.params,error:e.error}}}),s=n.doneData=u.map({named:'doneData',fn:function(e){return e.result}}),l=n.failData=c.map({named:'failData',fn:function(e){return e.error}}),d=o({scope:{getHandler:n.use.getCurrent=function(){return t},finally:i,handlerId:me(a,'sid')},node:[K({fn:function(e,r,n){var t,a=e.params,o=e.req,i=r.finally,u=r.getHandler,f=r.handlerId,c=ur(a,o,1,i,n),s=ur(a,o,0,i,n);try{t=(pe(n)&&pe(n).handlers[f]||u())(a)}catch(l){return void s(l)}D(t)&&_(t.then)?t.then(c,s):c(t)}})],meta:{op:'fx',fx:'runner'}});a.scope.runner=d,a.seq.push(G({fn:function(e,r,n){return de(n)?{params:e,req:{rs:function(){},rj:function(){}}}:e}}),K({fn:function(e,r,n){return f({target:r.runner,params:e,defer:1,forkPage:pe(n)}),e.params}})),n.create=function(e){var r=g(),t={params:e,req:r};if(Me){if(!_e){var a=Me;r.req.finally((function(){Re(a)})).catch((function(){}))}f({target:n,params:t,forkPage:Me})}else f(n,t);return r.req};var v=n.inFlight=m(0,{named:'inFlight'}).on(n,(function(e){return e+1})).on(i,(function(e){return e-1}));ve(i,'needFxCounter',1),ve(n,'needFxCounter',1);var h=n.pending=v.map({fn:function(e){return e>0},named:'pending'});return ge(n,[i,u,c,s,l,h,v,d]),n}function y(e,r){var n=p(r||c(e,'merge'));return t(e,'merge','first argument'),Ye({from:e,to:n,meta:{op:'merge'}}),n}function b(e){var r=0;return u(sr,(function(n){n in e&&(null==e[n]&&O("sample: "+n+" should be defined"),r=1)})),r}function k(){for(var e,r,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var u,f,c=We(a),s=c[0],d=s[0],g=s[1],h=s[2],k=c[1];void 0===g&&D(d)&&b(d)&&(g=d.clock,h=d.fn,f=d.greedy,e=d.target,r=d.name,u=d.sid,d=d.source);var x=1;void 0===d&&(t(g,'sample','clock'),Array.isArray(g)&&(g=y(g)),d=g,x=0),x&&!j(d)&&(d=v(d)),void 0===g&&(g=d),t(g,'sample','clock'),r=k||r||d.shortName;var w=!!e;if(!e)if(M(d)&&M(g)){var I=h?h(Z(ue(d)),Z(ue(g))):Z(ue(d));e=m(I,{name:r,sid:u})}else e=p(r),l('sampleTarget',ae(e));if(M(d)){var P=ue(d);ge(d,[Xe(g,e,{scope:{fn:h},node:[l('sampleSourceLoader'),!f&&U({priority:"sampler"}),W({store:P,to:h?"a":A}),h&&G({fn:ne}),l('sampleSourceUpward',w)],meta:{op:"sample",sample:S}})]),l('sampleStoreSource',P)}else{var C=Y(0),N=Y(),q=Y();l('sampleNonStoreSource',C,N,q),o({parent:d,node:[Q({store:N}),W({from:"value",store:1,target:C})],family:{owners:[d,e,g],links:e},meta:{op:"sample",sample:'source'},regional:1}),ge(d,[Xe(g,e,{scope:{fn:h},node:[l('sampleSourceLoader'),Q({store:q}),W({store:C}),J({fn:function(e){return e}}),!f&&U({priority:"sampler"}),W({store:N}),W({store:q,to:"a"}),h&&G({fn:re}),l('sampleSourceUpward',w)],meta:{op:"sample",sample:'clock'}})])}return e}function x(e,n){if(Array.isArray(e)&&(e=new Map(e)),e instanceof Map){for(var t,a={},o=r(e);!(t=o()).done;){var i=t.value,u=i[0],f=i[1];j(u)||O('Map key should be a unit'),n&&n(u,f),a[u.sid]=f}return a}return e}Object.defineProperty(exports,'__esModule',{value:1});for(var w='undefined'!=typeof Symbol&&Symbol.observable||'@@observable',S='store',A='stack',j=function(e){return(_(e)||D(e))&&'kind'in e},I=function(e){return function(r){return j(r)&&r.kind===e}},M=I(S),P=I("event"),C=I("effect"),N=I("domain"),q=I("scope"),F={__proto__:null,unit:j,store:M,event:P,effect:C,domain:N,scope:q},O=function(e){throw Error(e)},D=function(e){return'object'==typeof e&&null!==e},_=function(e){return'function'==typeof e},E=function(e){D(e)||_(e)||O('expect first argument be an object')},R=function(){var e=0;return function(){return""+ ++e}},z=R(),V=R(),B=R(),T=function(e,r){return e.bind(null,r)},H=function(e,r){return{id:V(),type:e,data:r}},L=0,U=function(e){var r=e.priority;return H("barrier",{barrierID:++L,priority:void 0===r?"barrier":r})},W=function(e){var r=e.from,n=e.target,t=e.to;return H('mov',{from:void 0===r?S:r,store:e.store,to:void 0===t?n?S:A:t,target:n})},$={defined:function(){return H('check',{type:'defined'})},changed:function(e){return H('check',{type:'changed',store:e.store})}},G=T(H,'compute'),J=T(H,"filter"),K=T(H,'run'),Q=function(e){return W({from:A,target:e.store})},X={__proto__:null,barrier:U,mov:W,check:$,compute:G,filter:J,run:K,update:Q},Y=function(e){return{id:V(),current:e}},Z=function(e){return e.current},ee=function(e,r){e.before||(e.before=[]),e.before.push(r)},re=function(e,r,n){return(0,r.fn)(e,n.a)},ne=function(e,r,n){return(0,r.fn)(n.a,e)},te=function(e,r){return(0,r.fn)(e)},ae=function(e){return e.graphite||e},oe=function(e){return e.family.owners},ie=function(e){return e.family.links},ue=function(e){return e.stateRef},fe=function(e){return e.config},ce=function(e){return e["\u0254"]},se=function(e){return e.value},le=function(e){return e.subscribers},de=function(e){return e.parent},pe=function(e){return e.forkPage},me=function(e,r){return ae(e).meta[r]},ve=function(e,r,n){return ae(e).meta[r]=n},ge=function(e,r){for(var n=ae(e),t=0;t<r.length;t++){var a=ae(r[t]);"domain"!==n.family.type&&(a.family.type="crosslink"),oe(a).push(n),ie(n).push(a)}},he=null,ye=function(){return he&&he.template},be=function(e){return e&&he&&he.sidRoot&&(e=he.sidRoot+"\u0254"+e),e},ke=function(e){return void 0===e&&(e=[]),(Array.isArray(e)?e:[e]).flat().map(ae)},xe=function(e,r){return e.includes(r)},we=function(e,r){var n=e.indexOf(r);-1!==n&&e.splice(n,1)},Se=null,Ae=function e(r,n){if(!r)return n;if(!n)return r;var t,a=r.v.type===n.v.type;return(a&&r.v.id>n.v.id||!a&&"sampler"===r.v.type)&&(t=r,r=n,n=t),t=e(r.r,n),r.r=r.l,r.l=t,r},je=[],Ie=0;Ie<5;)je.push({first:null,last:null,size:0}),Ie+=1;var Me,Pe,Ce=function(){for(var e=0;e<5;e++){var r=je[e];if(r.size>0){if(2===e||3===e){r.size-=1;var n=Se.v;return Se=Ae(Se.l,Se.r),n}1===r.size&&(r.last=null);var t=r.first;return r.first=t.r,r.size-=1,t.v}}},Ne=function(e,r,n,t,a,o){return qe(0,{a:null,b:null,node:n,parent:t,value:a,page:r,forkPage:o},e)},qe=function(e,r,n,t){void 0===t&&(t=0);var a=Fe(n),o=je[a],i={v:{idx:e,stack:r,type:n,id:t},l:null,r:null};2===a||3===a?Se=Ae(Se,i):(0===o.size?o.first=i:o.last.r=i,o.last=i),o.size+=1},Fe=function(e){switch(e){case'child':return 0;case'pure':return 1;case"barrier":return 2;case"sampler":return 3;case"effect":return 4;default:return-1}},Oe=new Set,De=1,_e=0,Ee=null,Re=function(e){Me=e},ze=function(e){Ee=e},Ve=function(e,r){if(e){for(;e&&!e.reg[r];)e=de(e);if(e)return e}return null},Be=function(e,r,n,t,a){var o=Ve(e,t.id);return o?o.reg[t.id]:r?(Te(r,t,a),r.reg[t.id]):t},Te=function e(r,n,t){var a=r.reg;if(!a[n.id]){var o={id:n.id,current:n.current};if(n.sid&&(r.sidIdMap[n.sid]=n.id),n.sid&&n.sid in r.sidValuesMap)o.current=r.sidValuesMap[n.sid];else if((t||!n.noInit)&&n.before){var i=0;u(n.before,(function(n){switch(n.type){case"map":var u=n.from;if(u||n.fn){u&&e(r,u,t);var f=u&&a[u.id].current;o.current=n.fn?n.fn(f):f}break;case'field':e(r,n.from,t);var c=a[n.from.id];i||(i=1,o.current=Array.isArray(o.current)?[].concat(o.current):Object.assign({},o.current)),o.current[n.field]=a[c.id].current}}))}a[n.id]=o}},He=function(e,r,n){var t=r.fn;try{return t(se(n),e.scope,n)}catch(a){console.error(a),e.fail=1}},Le=function(e){return e.compositeName},Ue=function(e,r){E(e),ce(e)&&r(fe(e),ce(e))},We=function(e){var r;return Ue(e[0],(function(n,t){r=n,e=t})),[e,r]},$e=function(e,r){we(e.next,r),we(oe(e),r),we(ie(e),r)},Ge=function e(r,n,t){var a;r.next.length=0,r.seq.length=0,r.scope=null;for(var o=ie(r);a=o.pop();)$e(a,r),(n||t&&!me(r,'sample')||"crosslink"===a.family.type)&&e(a,n,'on'!==me(a,'op')&&t);for(o=oe(r);a=o.pop();)$e(a,r),t&&"crosslink"===a.family.type&&e(a,n,'on'!==me(a,'op')&&t)},Je=function(e){return e.clear()},Ke=function(e,r){var n=(void 0===r?{}:r).deep,t=0;if(e.ownerSet&&e.ownerSet.delete(e),M(e))Je(le(e));else if(N(e)){t=1;var a=e.history;Je(a.events),Je(a.effects),Je(a.stores),Je(a.domains)}Ge(ae(e),!!n,t)},Qe=function(e){var r=function(){return Ke(e)};return r.unsubscribe=r,r},Xe=function(e,r,n){return o({node:n.node,parent:e,child:r,scope:n.scope,meta:n.meta,family:{owners:[e,r],links:r},regional:1})},Ye=function(e){var r;Ue(e,(function(n,t){r=n,e=t}));var n=e.from,a=e.to,i=e.meta,u=void 0===i?{op:'forward'}:i;return t(n,'forward','"from"'),t(a,'forward','"to"'),r&&(u.config=r),Qe(o({parent:n,child:a,meta:u,family:{},regional:1}))},Ze=function(e,r){return _(r)||O('.watch argument should be a function'),Qe(o({scope:{fn:r},node:[K({fn:te})],parent:e,meta:{op:'watch'},family:{owners:e},regional:1}))},er=function e(r,n){return D(r)&&(e(fe(r),n),null!=r.name&&(D(r.name)?e(r.name,n):_(r.name)?n.handler=r.name:n.name=r.name),r.loc&&(n.loc=r.loc),(r.sid||null===r.sid)&&(n.sid=r.sid),r.handler&&(n.handler=r.handler),r.updateFilter&&(n.updateFilter=r.updateFilter),de(r)&&(n.parent=de(r)),'strict'in r&&(n.strict=r.strict),r.named&&(n.named=r.named),e(ce(r),n)),n},rr=function(e,r,n){void 0===n&&(n="event"),de(e)&&de(e).hooks[n](r)},nr=function(e,r,n,t){var a=er({name:t,config:n},{}),o="domain"===e,i=z(),u=a.parent,f=void 0===u?null:u,c=a.sid,l=void 0===c?null:c,d=a.strict,p=void 0===d?1:d,m=a.named,v=void 0===m?null:m,g=v||a.name||(o?'':i),h=s(g,f),y={unit:r.kind=e,name:r.shortName=g,sid:r.sid=be(l),named:v,unitId:r.id=i};if(r.parent=f,r.compositeName=h,r.defaultConfig=a,r.thru=function(e){return e(r)},r.getType=function(){return h.fullName},!o){r.subscribe=function(e){return E(e),r.watch(_(e)?e:function(r){e.next&&e.next(r)})},r[w]=function(){return r};var b=ye();b&&(y.nativeTemplate=b)}return Pe=p,y},tr=function(e){return p({named:e})},ar=function(e,r,n,t){var a,o;D(n)&&(o=n,n=n.fn);var i=p(((a={name:e.shortName+" \u2192 *"})["\u0254"]=o,a));return Xe(e,i,{scope:{fn:n},node:t,meta:{op:r}}),i},or=function(e,r,n,t,a,o){var i=ue(r),u=[W({store:i,to:"a"}),G({fn:t?ne:re}),$.defined(),$.changed({store:i}),o&&J({fn:function(e,r,n){return o(e,n.a)}}),Q({store:i})];return l('storeOnMap',i,u,M(e)&&ue(e)),Xe(e,r,{scope:{fn:a},node:u,meta:{op:n}})},ir=function(e,r,n,t,a){var o=e?function(e){return e.slice()}:function(e){return Object.assign({},e)},u=e?[]:{},f=o(u),s=Y(f),d=Y(1);s.type=e?'list':'shape',s.noInit=1,l('combineBase',s,d);var p=m(f,{name:t||c(n)}),v=ue(p);v.noInit=1,ve(p,'isCombine',1);var g=[$.defined(),W({store:s,to:"a"}),J({fn:function(e,r,n){return e!==n.a[r.key]}}),W({store:d,to:'b'}),G({fn:function(e,r,n){var t=r.key;r.spread&&n.b&&(n.a=(0,r.clone)(n.a)),n.a[t]=e}}),W({from:"a",target:s}),W({from:"value",store:0,target:d}),U({priority:"barrier"}),W({from:"value",store:1,target:d}),W({store:s}),a&&G({fn:te}),$.changed({store:v})];return i(n,(function(e,n){if(M(e)){u[n]=e.defaultState,f[n]=e.getState();var t=Xe(e,p,{scope:{key:n,clone:o,fn:a,spread:r},node:g,meta:{op:'combine'}}),i=ue(e);ee(s,{type:'field',field:n,from:i}),l('combineField',i,t)}else f[n]=u[n]=e})),p.defaultShape=n,ee(v,{type:"map",from:s,fn:a}),ye()||(p.defaultState=a?v.current=a(f):u),p},ur=function(e,r,n,t,a){return function(o){return f({target:[t,fr],params:[n?{status:'done',params:e,result:o}:{status:'fail',params:e,error:o},{fn:n?r.rs:r.rj,value:o}],defer:1,page:a.page,forkPage:pe(a)})}},fr=o({node:[K({fn:function(e){(0,e.fn)(e.value)}})],meta:{op:'fx',fx:'sidechain'}}),cr=function(e,r,n){return e.create=function(r){return f(e,r),r},ae(e).seq.push(G({fn:function(e,r,n){return n.forkPage=null,e}})),e.watch((function(e){ge(n,[e]),r.add(e),e.ownerSet||(e.ownerSet=r),de(e)||(e.parent=n)})),ge(n,[e]),function(n){return r.forEach(n),e.watch(n)}},sr=['source','clock','target'],lr=function(e,r,n,t){var a=e[r];a&&f({target:a,params:Array.isArray(a)?a.map((function(){return n})):n,defer:1,stack:t})};exports.allSettled=function(e,r){var n=r.scope,t=r.params;if(!j(e))return Promise.reject(Error('first argument should be unit'));var a=g();a.parentFork=Me;var o=n.fxCount;o.scope.defers.push(a);var i=[e],u=[];return C(e)?u.push({params:t,req:{rs:function(e){a.value={status:'done',value:e}},rj:function(e){a.value={status:'fail',value:e}}}}):u.push(t),i.push(o),u.push(null),f({target:i,params:u,forkPage:n}),a.req},exports.attach=function(e){var r,n;Ue(e,(function(r,t){n=r,e=t}));var t=e.source,a=e.effect,o=e.mapParams,i=!C(a)&&_(a);if(o||(o=t&&!i?function(e,r){return r}:function(e){return e}),i){var u=a;a=h((function(e){return u(e[0],e[1])}))}var c=h(e,n);ve(c,'attached',1);var s,l,d=ae(c).scope.runner,p=function(e,r,n){var t,a=e.params,i=e.req,u=r.finally,c=r.effect,s=r.isPlain,l=ur(a,i,0,u,n);try{t=o(a,n.a)}catch(d){return l(d)}f({target:c,params:{params:s?[t,n.a]:t,req:{rs:ur(a,i,1,u,n),rj:l}},page:n.page,defer:1})};return t?(M(t)?(l=t,ge(t,[c])):(l=v(t),ge(c,[l])),s=[K({fn:function(e){return e}}),W({store:ue(l),to:"a"}),G({fn:p})]):s=[K({fn:p})],ge(a,[c]),d.scope.effect=a,d.scope.isPlain=i,(r=d.seq).splice.apply(r,[0,1].concat(s)),rr(a,c,"effect"),c},exports.clearNode=Ke,exports.combine=v,exports.createApi=function(){for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];var t=We(r),a=t[0],o=a[0],u=a[1],f=t[1],c={};return i(u,(function(e,r){var n=c[r]=p(r,{parent:de(o),config:f});o.on(n,e),rr(o,n)})),c},exports.createDomain=function e(r,n){var t=new Set,a=new Set,u=new Set,f=new Set,c=o({family:{type:"domain"},regional:1}),s={history:{domains:t,stores:a,effects:u,events:f},graphite:c};c.meta=nr("domain",s,n,r);var l=['onEvent','onEffect','onStore','onDomain'].map(tr),d=l[0],v=l[1],g=l[2],y=l[3];s.hooks={event:d,effect:v,store:g,domain:y},s.onCreateEvent=cr(d,f,s),s.onCreateEffect=cr(v,u,s),s.onCreateStore=cr(g,a,s),s.onCreateDomain=cr(y,t,s),s.createEvent=s.event=function(e,r){return d(p(e,{parent:s,config:r}))},s.createEffect=s.effect=function(e,r){return v(h(e,{parent:s,config:r}))},s.createDomain=s.domain=function(r,n){return e({name:r,parent:s,config:n})},s.createStore=s.store=function(e,r){return g(m(e,{parent:s,config:r}))};var b=de(s);return b&&(i(s.hooks,(function(e,r){Ye({from:e,to:b.hooks[r]})})),b.hooks.domain(s)),s},exports.createEffect=h,exports.createEvent=p,exports.createNode=o,exports.createStore=m,exports.createStoreObject=function(){return console.error('createStoreObject is deprecated, use combine instead'),v.apply(void 0,arguments)},exports.fork=function(e,r){var n,t=e;N(e)&&(n=e,t=r);var a=function(e){var r=o({scope:{defers:[],inFlight:0,fxID:0},node:[G({fn:function(e,r,n){de(n)?'finally'===me(de(n).node,'named')?r.inFlight-=1:(r.inFlight+=1,r.fxID+=1):r.fxID+=1}}),U({priority:"sampler"}),K({fn:function(e,r){var n=r.defers,t=r.fxID;r.inFlight>0||0===n.length||Promise.resolve().then((function(){r.fxID===t&&u(n.splice(0,n.length),(function(e){Re(e.parentFork),e.rs(e.value)}))}))}})],meta:{unit:"forkInFlightCounter"}}),n=o({node:[G({fn:function(e,r,n){var t=de(n);if(t&&de(t)){var a=t.node;if(!me(a,'isCombine')||'combine'!==me(de(t).node,'op')){var o=pe(n),i=a.scope.state.id,u=me(a,'sid');o.sidIdMap[u]=i,o.sidValuesMap[u]=e}}}})]}),t={cloneOf:e,reg:{},sidValuesMap:{},sidIdMap:{},getState:function(e){return'current'in e?Be(Ee,t,null,e).current:function(e,r){return Be(Ee,r,e,e.scope.state,1).current}(ae(e),t)},kind:"scope",graphite:o({family:{type:"domain",links:[r,n]},meta:{unit:'fork'},scope:{forkInFlightCounter:r}}),additionalLinks:{},handlers:{},fxCount:r,storeChange:n};return t}(n);if(t){if(t.values){var i=x(t.values,(function(e){return!M(e)&&O('Values map can contain only stores as keys')}));Object.assign(a.sidValuesMap,i)}t.handlers&&(a.handlers=x(t.handlers,(function(e){C(e)||O("Handlers map can contain only effects as keys"),me(e,'attached')&&O('Handlers can`t accept attached effects')})))}return a},exports.forward=Ye,exports.fromObservable=function(e){E(e);var r=w in e?e[w]():e;r.subscribe||O('expect observable to have .subscribe');var n=p(),t=Qe(n);return r.subscribe({next:n,error:t,complete:t}),n},exports.guard=function(){for(var e={op:'guard'},r='guard',n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var u=We(a),f=u[0],c=f[0],s=f[1],l=u[1];l&&(e.config=l,l.name&&(r=l.name)),s||(c=(s=c).source);var d=s,m=d.filter,g=d.greedy,h=d.clock,b=d.name,x=void 0===b?r:b,w=s.target||p(x,e.config),S=j(m),A=1;return void 0===c&&(t(h,'guard','clock'),Array.isArray(h)&&(h=y(h)),c=h,A=0),A&&!j(c)&&(c=v(c)),h&&(t(h,'guard','clock'),c=k({source:c,clock:h,greedy:g,fn:S?null:function(e,r){return{source:e,clock:r}}})),t(w,'guard','target'),S?k({source:m,clock:c,target:o({node:[J({fn:function(e){return e.guard}}),G({fn:function(e){return e.data}})],child:w,meta:e,family:{owners:[c,m,w].concat([].concat(h||[])),links:w},regional:1}),fn:function(e,r){return{guard:e,data:r}},greedy:g,name:x}):(_(m)||O('`filter` should be function or unit'),Xe(c,w,{scope:{fn:m},node:h?[J({fn:function(e,r){return(0,r.fn)(e.source,e.clock)}}),G({fn:function(e){return e.source}})]:[J({fn:te})],meta:e})),w},exports.hydrate=function(e,r){var n=r.values;D(n)||O('values property should be an object');var t,a,o,i,c=x(n),s=Object.getOwnPropertyNames(c),l=[],d=[];q(e)?(t=e,Object.assign(t.sidValuesMap,c),t.cloneOf||O('scope should be created from domain'),a=ae(t.cloneOf)):N(e)?a=ae(e):O('first argument of hydrate should be domain or scope'),o=function(e,r){xe(s,r)&&(l.push(e),d.push(c[r]))},i=[],function e(r){xe(i,r)||(i.push(r),me(r,'unit')===S&&me(r,'sid')&&o(r,me(r,'sid')),u(r.next,e),u(oe(r),e),u(ie(r),e))}(a),f({target:l,params:d,forkPage:t})},exports.is=F,exports.launch=f,exports.merge=y,exports.restore=function(e,r,n){if(M(e))return e;if(j(e)){var t,a,o,u=de(e);return P(e)&&(t=m(r,(a={parent:u,name:e.shortName},a["\u0254"]=n,a)).on(e,(function(e,r){return r}))),C(e)&&(t=m(r,((o={parent:u,name:e.shortName})["\u0254"]=n,o)),Ye({from:e.doneData,to:t})),u&&u.hooks.store(t),t}var f=Array.isArray(e)?[]:{};return i(e,(function(e,r){f[r]=M(e)?e:m(e,{name:r})})),f},exports.sample=k,exports.scopeBind=function(e,r){var n=(void 0===r?{}:r).scope;n||Me||O('scopeBind cannot be called outside of forked .watch');var t=n||Me;return C(e)?function(r){var n=g();return f({target:e,params:{params:r,req:n},forkPage:t}),n.req}:function(r){return f({target:e,params:r,forkPage:t}),r}},exports.serialize=function(e,r){var n=(void 0===r?{}:r).ignore,t=(void 0===n?[]:n).map((function(e){return e.sid})),a={};return i(e.sidValuesMap,(function(r,n){if(!t.includes(n)){var o=e.sidIdMap[n];a[n]=o&&o in e.reg?e.reg[o].current:r}})),a},exports.setStoreName=function(e,r){e.shortName=r,Object.assign(Le(e),s(r,de(e)))},exports.split=function(){for(var e,r=arguments.length,n=new Array(r),t=0;t<r;t++)n[t]=arguments[t];var a=We(n),u=a[0],f=u[0],c=u[1],s=a[1],d=!c;d&&(e=f.cases,c=f.match,f=f.source);var m=M(c),v=!j(c)&&_(c),g=!m&&!v&&D(c);e||(e={}),d||(g||O('match should be an object'),i(c,(function(r,n){e[n]=p(s)})),e.__=p(s));var h,y=new Set([].concat(f,Object.values(e))),b=Object.keys(m||v?e:c);if(m||v)m&&y.add(c),h=[m&&U({priority:'sampler'}),m&&W({store:ue(c),to:'a'}),J({fn:function(e,r,n){var t=String(m?n.a:c(e));lr(r,xe(b,t)?t:'__',e,n)}})];else if(g){var k=Y({});k.type='shape';var x,w=[W({store:k,to:"a"}),G({fn:function(e,r,n){n.a[r.key]=e}})],S=[];i(c,(function(e,r){if(j(e)){x=1,S.push(r),y.add(e);var n=Xe(e,[],{node:w,scope:{key:r}});if(M(e)){k.current[r]=e.getState();var t=ue(e);ee(k,{type:'field',field:r,from:t}),l('splitMatchStore',t,n)}}})),x&&l('splitBase',k),h=[x&&U({priority:'sampler'}),x&&W({store:k,to:'a'}),J({fn:function(e,r,n){for(var t=0;t<b.length;t++){var a=b[t];if(xe(S,a)?n.a[a]:c[a](e))return void lr(r,a,e,n)}lr(r,'__',e,n)}})]}else O('expect match to be unit, function or object');if(o({meta:{op:'split'},parent:f,scope:e,node:h,family:{type:'crosslink',owners:Array.from(y)},regional:1}),!d)return e},exports.step=X,exports.version="21.8.12",exports.withFactory=function(e){var r=e.name,n=e.loc,t=e.method,i=e.fn;return a(o({meta:{sidRoot:be(e.sid),name:r,loc:n,method:t}}),i)},exports.withRegion=a;
//# sourceMappingURL=compat.js.map
